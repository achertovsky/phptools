#!/bin/bash

function check() {
    checkFileExistence phpcs.xml
    echo -e "\033[1;32mphpcs:\033[0m"
    phpcs $1
    checkFileExistence phpmd.xml
    echo -e "\033[1;32mphpmd:\033[0m"
    php -d 'error_reporting=E_ALL&~E_NOTICE&~E_DEPRECATED' /usr/bin/phpmd $1 text phpmd.xml
    checkFileExistence phpstan.neon
    echo -e "\033[1;32mphpstan:\033[0m"
    phpstan analyze $1
    checkFileExistence phpcpd.xml
    echo -e "\033[1;32mphpcpd:\033[0m"
    phpcpdrun $1
    echo -e "\033[1;32mphpmnd:\033[0m"
    checkFileExistence phpmnd.xml
    phpmndrun $1
}

function checkFileExistence() {
    if [ ! -f $1 ]; then
        echo "File $1 not found! Try launching suggest-config"
        exit 1
    fi
}

if [ $# -eq 0 ]
	then
        check ./
        exit 1
fi

while getopts "mp:" opt
	do
	case $opt in
        m)
            for file in $(git ls-files -om --exclude-standard)
                do
                    check $file
                done

            exit 1
            ;;
        p)
            check $OPTARG
            ;;
	esac
done
